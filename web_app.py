import streamlit as st
import requests
import json

st.set_page_config(page_title="–ï–ì–≠-GPT", page_icon="ü§ñ")
st.title("–ï–ì–≠-GPT –ø–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–µ 2026 ‚Äî —Ç–µ–ø–µ—Ä—å —Ç–æ—á–Ω–æ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç!")
st.markdown("–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π Ollama API (mlvoca.com) ‚Äî –±–µ–∑ –∫–ª—é—á–µ–π, –±–µ–∑ –ª–∏–º–∏—Ç–æ–≤. –í—ã–±–µ—Ä–∏ –Ω–æ–º–µ—Ä –∏ –∂–º–∏ –∫–Ω–æ–ø–∫—É!")

num = st.selectbox("–ù–æ–º–µ—Ä –∑–∞–¥–∞—á–∏:", ["6", "8", "12", "15", "16", "19-21", "23", "24", "25", "27"])

def generate_task(num):
    prompt = f"""–¢—ã —ç–∫—Å–ø–µ—Ä—Ç –§–ò–ü–ò –ø–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–µ 2026 –≥–æ–¥–∞. –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É ‚Ññ{num} –¥–ª—è –ï–ì–≠ –ø–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–µ (–Ω–µ –∏–∑ –æ—Ç–∫—Ä—ã—Ç–æ–≥–æ –±–∞–Ω–∫–∞).
    
    –í—ã–≤–µ–¥–∏ —Å—Ç—Ä–æ–≥–æ –≤ —Ñ–æ—Ä–º–∞—Ç–µ:
    1. –ü–æ–ª–Ω–æ–µ —É—Å–ª–æ–≤–∏–µ –∑–∞–¥–∞—á–∏
    2. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç (—á–∏—Å–ª–æ –∏–ª–∏ –∫–æ–¥)
    3. –ü–æ–¥—Ä–æ–±–Ω—ã–π —Ä–∞–∑–±–æ—Ä —Ä–µ—à–µ–Ω–∏—è —à–∞–≥ –∑–∞ —à–∞–≥–æ–º
    
    –°–¥–µ–ª–∞–π —Å—Ä–µ–¥–Ω–µ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏, —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ–π."""
    
    url = "https://mlvoca.com/api/generate"
    payload = {
        "model": "tinyllama",  # –õ—ë–≥–∫–∞—è –º–æ–¥–µ–ª—å, —Ä–∞–±–æ—Ç–∞–µ—Ç –±—ã—Å—Ç—Ä–æ; –º–æ–∂–Ω–æ "deepseek-r1:1.5b" –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö
        "prompt": prompt,
        "stream": False
    }
    
    try:
        response = requests.post(url, json=payload, timeout=30)
        response.raise_for_status()
        data = response.json()
        return data.get("response", "–û—à–∏–±–∫–∞: –æ—Ç–≤–µ—Ç –ø—É—Å—Ç–æ–π")
    except Exception as e:
        return f"–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: {str(e)}. –ü–æ–ø—Ä–æ–±—É–π –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É."

if st.button("–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞—á—É"):
    with st.spinner("–ì–µ–Ω–µ—Ä–∏—Ä—É—é —Å Ollama... (5‚Äì15 —Å–µ–∫)"):
        result = generate_task(num)
        st.success("–ì–æ—Ç–æ–≤–æ! –í–æ—Ç —Ç–≤–æ—è –∑–∞–¥–∞—á–∞:")
        st.markdown(result)

st.markdown("---")
st.subheader("–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ—à–µ–Ω–∏–µ")
solution = st.text_area("–í—Å—Ç–∞–≤—å —Ç–µ–∫—Å—Ç —Å–≤–æ–µ–≥–æ —Ä–µ—à–µ–Ω–∏—è (–∏–ª–∏ –æ—Ç–≤–µ—Ç):", height=100)
if st.button("–ü—Ä–æ–≤–µ—Ä–∏—Ç—å"):
    if solution.strip():
        with st.spinner("–ü—Ä–æ–≤–µ—Ä—è—é..."):
            check_prompt = f"""–ü—Ä–æ–≤–µ—Ä—å —Ä–µ—à–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ ‚Ññ{num} –ï–ì–≠ –ø–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–µ:
            
            –†–µ—à–µ–Ω–∏–µ —É—á–µ–Ω–∏–∫–∞: {solution}
            
            –û—Ç–≤–µ—Ç—å:
            - –ï—Å—Ç—å –æ—à–∏–±–∫–∏? (–¥–∞/–Ω–µ—Ç + –æ–±—ä—è—Å–Ω–∏)
            - –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥
            - –°–∫–æ–ª—å–∫–æ –±–∞–ª–ª–æ–≤ –¥–∞–ª –±—ã —ç–∫—Å–ø–µ—Ä—Ç –§–ò–ü–ò (–∏–∑ 100, —Å –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ–º)"""
            
            check_result = generate_task(num)  # –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é, –Ω–æ —Å check_prompt
            # –ó–∞–º–µ–Ω—è–µ–º prompt –≤ payload –≤—ã—à–µ, –Ω–æ –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã –≤—ã–∑—ã–≤–∞–µ–º –∑–∞–Ω–æ–≤–æ
            url = "https://mlvoca.com/api/generate"
            payload = {"model": "tinyllama", "prompt": check_prompt, "stream": False}
            response = requests.post(url, json=payload, timeout=30)
            data = response.json()
            st.markdown(f"**–†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏:**\n{data.get('response', '–û—à–∏–±–∫–∞')}")
    else:
        st.warning("–°–Ω–∞—á–∞–ª–∞ –≤–≤–µ–¥–∏ —Ä–µ—à–µ–Ω–∏–µ!")

st.caption("–ò—Å—Ç–æ—á–Ω–∏–∫: mlvoca.com ‚Äî –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π Ollama API 2025. –ï—Å–ª–∏ –º–µ–¥–ª–µ–Ω–Ω–æ ‚Äî –º–æ–¥–µ–ª—å 'deepseek' –≤–º–µ—Å—Ç–æ 'tinyllama'.")
